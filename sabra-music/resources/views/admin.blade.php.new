<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="csrf-token" content="{{ csrf_token() }}">
	<title>Admin â€¢ Sabra Music</title>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
	<style>
		:root{--bg:#0f1724;--panel:#0b1220;--muted:#9ca3af;--accent:#10b981;--card:#0b1226}
		*{box-sizing:border-box}
		body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#0b1220 0%, #071022 100%);color:#e6eef6}
		.app{display:flex;min-height:100vh}

		/* Sidebar */
		.sidebar{width:260px;padding:20px 22px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-right:1px solid rgba(255,255,255,0.03)}
		.brand{display:flex;align-items:center;gap:12px;margin-bottom:10px}
		.brand .logo{width:44px;height:44px;border-radius:10px;background:#fff url("{{ asset('images/Group-237.png') }}") center/cover no-repeat}
		.brand h2{font-size:18px;margin:0}
		.small{font-size:13px}
		.nav{margin-top:14px}
		.nav .section{margin-bottom:8px}
		.nav a{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;color:var(--muted);text-decoration:none;margin-bottom:6px}
		.nav a.active, .nav a:hover{background:rgba(255,255,255,0.03);color:#fff}
		.nav a i{width:18px;text-align:center}
		.submenu{padding-left:12px;display:none;flex-direction:column;margin-top:6px}
		.submenu a{padding:8px 10px;font-size:14px}

		/* Main */
		.main{flex:1;padding:22px}
		header.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
		.topbar-left{display:flex;align-items:center;gap:14px}
		.search{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.03);padding:8px;border-radius:10px}
		.search input{border:0;background:transparent;color:#fff;outline:none;width:260px}
		.actions{display:flex;gap:10px;align-items:center}
		.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:#e6eef6;cursor:pointer}
		.btn.primary{background:var(--accent);border:none;color:#07221a}
		.icon-btn{background:transparent;border:0;color:var(--muted);font-size:18px;cursor:pointer}

		/* Stats */
		.stats{display:flex;gap:14px;margin-bottom:18px}
		.card{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
		.card .label{color:var(--muted);font-size:13px}
		.card .value{font-size:20px;margin-top:6px}

		/* Layout */
		.grid{display:grid;grid-template-columns:1fr 380px;gap:20px}
		.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03)}
		.panel h3{margin:0 0 10px}

		/* Tables */
		table{width:100%;border-collapse:collapse}
		th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03);font-size:14px}
		th{color:var(--muted);font-weight:600}

		/* Events & bookings tabs */
		.tabs{display:flex;gap:8px;margin-bottom:12px}
		.tabs button{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer}
		.tabs button.active{background:rgba(255,255,255,0.03);color:#fff}

		/* Forms - Create Event */
		.form-row{display:flex;gap:8px}
		.form-col{flex:1}
		.input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e6eef6}
		.label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block}
		.file-input{display:none}
		.file-label{display:flex;align-items:center;gap:8px;padding:10px;border-radius:8px;border:1px dashed rgba(255,255,255,0.04);cursor:pointer;color:var(--muted)}
		.img-preview{width:100%;height:140px;object-fit:cover;border-radius:8px;background:#031224;display:block}
		.select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e6eef6}
		.help{font-size:12px;color:var(--muted);margin-top:6px}

		/* Alert Messages */
		.alert {
		  padding: 12px 15px;
		  margin: 15px 0;
		  border-radius: 8px;
		  font-size: 14px;
		}

		.alert-error {
		  background-color: rgba(239, 68, 68, 0.15);
		  color: #ef4444;
		  border: 1px solid rgba(239, 68, 68, 0.3);
		}

		.alert-success {
		  background-color: rgba(16, 185, 129, 0.15);
		  color: #10b981;
		  border: 1px solid rgba(16, 185, 129, 0.3);
		}

		/* Responsive */
		@media (max-width:1000px){.sidebar{display:none}.grid{grid-template-columns:1fr}.form-row{flex-direction:column}}
	</style>
</head>
<body>
	<div class="app">
		<aside class="sidebar">
			<div class="brand"><div class="logo"></div><h2>Sabra Admin</h2></div>
			<div class="small" style="color:var(--muted)">Manage site content</div>
			<nav class="nav">
				<div class="section">
					<a href="#dashboard" class="active" data-target="dashboard"><i class="fas fa-house"></i> Dashboard</a>
				</div>

				<div class="section">
					<a href="#bookings" data-target="bookings"><i class="fas fa-calendar-check"></i> Bookings <i style="margin-left:auto" class="fas fa-chevron-down toggle"></i></a>
					<div class="submenu" data-parent="bookings">
						<a href="#all-bookings">All Bookings</a>
						<a href="#pending-approvals">Pending Approvals</a>
					</div>
				</div>

				<div class="section">
					<a href="#events" data-target="events"><i class="fas fa-calendar-day"></i> Events <i style="margin-left:auto" class="fas fa-chevron-down toggle"></i></a>
					<div class="submenu" data-parent="events">
						<a href="#add-event">âž• Add Event</a>
						<a href="#upcoming-events">Upcoming Events</a>
						<a href="#past-events">Past Events</a>
					</div>
				</div>

				<div class="section">
					<a href="#users" data-target="users"><i class="fas fa-users"></i> Users <i style="margin-left:auto" class="fas fa-chevron-down toggle"></i></a>
					<div class="submenu" data-parent="users">
						<a href="#all-users">All Users</a>
						<a href="#roles">Roles & Permissions</a>
					</div>
				</div>

				<div class="section">
					<a href="#settings" data-target="settings"><i class="fas fa-cog"></i> Settings</a>
				</div>
			</nav>
		</aside>

		<main class="main">
			<header class="topbar">
				<div class="topbar-left">
					<h1 style="margin:0;font-size:20px">Dashboard</h1>
					<div class="small" style="color:var(--muted)">Welcome back</div>
				</div>

				<div class="actions">
					<div class="search"><i class="fas fa-search" style="opacity:0.6"></i><input placeholder="Search events, users, bookings..." /></div>
					<button class="icon-btn" title="Notifications"><i class="fas fa-bell"></i></button>
					<div style="display:flex;align-items:center;gap:10px">
						<div style="text-align:right;margin-right:6px">
							<div style="font-size:13px">{{ Auth::user()->name }}</div>
							<div style="color:var(--muted);font-size:12px">{{ Auth::user()->email }}</div>
						</div>
						<form action="{{ route('logout') }}" method="POST" style="margin:0">
							@csrf
							<button type="submit" class="btn">Logout</button>
						</form>
					</div>
				</div>
			</header>

			@if(session('success'))
				<div class="alert alert-success">
					{{ session('success') }}
				</div>
			@endif

			@if(session('error'))
				<div class="alert alert-error">
					{{ session('error') }}
				</div>
			@endif

			<!-- Stats -->
			<div class="stats">
				<div class="card">
					<div class="label">Total Bookings ðŸ“…</div>
					<div class="value">{{ $stats['bookings'] }}</div>
				</div>
				<div class="card">
					<div class="label">Total Events ðŸŽ­</div>
					<div class="value">{{ $stats['events'] }}</div>
				</div>
				<div class="card">
					<div class="label">Total Users ðŸ‘¥</div>
					<div class="value">{{ $stats['users'] }}</div>
				</div>
			</div>

			<div class="grid">
				<section>
					<div class="panel" id="dashboard">
						<h3>Analytics</h3>
						<div style="display:flex;gap:12px;align-items:stretch;margin-top:12px">
							<div style="flex:1;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);min-height:160px">
								<div style="color:var(--muted);font-size:13px">Bookings per month</div>
								<div style="height:110px;background:linear-gradient(90deg,rgba(255,255,255,0.01),transparent);border-radius:6px;margin-top:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)">[Chart placeholder]</div>
							</div>
							<div style="width:220px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);min-height:160px">
								<div style="color:var(--muted);font-size:13px">Event participation</div>
								<div style="height:110px;background:linear-gradient(90deg,rgba(255,255,255,0.01),transparent);border-radius:6px;margin-top:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)">[Chart]</div>
							</div>
						</div>

						<div style="height:16px"></div>

						<h3 style="margin-top:6px">Recent Activities</h3>
						<div style="margin-top:8px;overflow:auto">
							<table>
								<thead>
									<tr><th>Time</th><th>Activity</th><th>User</th><th></th></tr>
								</thead>
								<tbody>
									@forelse($recent_activities as $activity)
										<tr>
											<td>{{ $activity['time']->diffForHumans() }}</td>
											<td>{{ $activity['activity'] }}</td>
											<td>{{ $activity['user'] }}</td>
											<td style="text-align:right;color:var(--muted)">
												@if($activity['type'] == 'booking')
													<a href="{{ route('admin.bookings.show', $activity['id']) }}" style="color:var(--muted)">View</a>
												@elseif($activity['type'] == 'event')
													<a href="{{ route('events.show', $activity['id']) }}" style="color:var(--muted)">View</a>
												@endif
											</td>
										</tr>
									@empty
										<tr><td colspan="4" style="text-align:center;color:var(--muted)">No recent activities</td></tr>
									@endforelse
								</tbody>
							</table>
						</div>
					</div>
				</section>

				<aside>
					<div class="panel" id="quick-actions">
						<h3>Quick Actions</h3>
						<div style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
							<button class="btn" onclick="openSection('bookings')">View Bookings</button>
							<button class="btn" onclick="openSection('events')">Create Event</button>
							<button class="btn" onclick="openSection('users')">Manage Users</button>
						</div>
					</div>

					<div style="height:12px"></div>

					<div class="panel" id="createEventPanel">
						<h3>Create Event</h3>
						<form id="createForm" action="{{ route('events.store') }}" method="POST" enctype="multipart/form-data" style="margin-top:12px">
							@csrf
							<div class="form-row">
								<div class="form-col">
									<label class="label">Title</label>
									<input class="input" id="evt-title" name="title" type="text" placeholder="Event title" required>

									<label class="label" style="margin-top:8px">Date</label>
									<input class="input" id="evt-date" name="event_date" type="date" required>

									<label class="label" style="margin-top:8px">Time</label>
									<input class="input" id="evt-time" name="event_time" type="time" required>

									<label class="label" style="margin-top:8px">Location</label>
									<input class="input" id="evt-location" name="location" type="text" placeholder="Location" required>

									<label class="label" style="margin-top:8px">Price (optional)</label>
									<input class="input" id="evt-price" name="price" type="text" placeholder="$0.00">

									<label class="label" style="margin-top:8px">Status</label>
									<select id="evt-status" name="status" class="select" required>
										<option value="draft">Draft</option>
										<option value="published">Published</option>
									</select>
								</div>

								<div style="width:220px">
									<label class="label">Cover Image</label>
									<img id="imgPreview" class="img-preview" src="{{ asset('images/bg1.jpg') }}" alt="image preview">
									<label class="file-label" style="margin-top:8px">
										<i class="fas fa-upload"></i>
										<span id="fileLabelText">Upload image</span>
										<input id="imgInput" name="image" class="file-input" type="file" accept="image/*">
									</label>
									<div class="help">Recommended size: 1200x600px. JPG or PNG.</div>
								</div>
							</div>

							<label class="label" style="margin-top:10px">Description</label>
							<textarea id="evt-desc" name="description" class="input" style="min-height:120px" placeholder="Short description" required></textarea>

							<div style="display:flex;gap:8px;margin-top:12px">
								<button type="submit" name="submit_type" value="publish" id="publishBtn" class="btn primary">Publish</button>
								<button type="submit" name="submit_type" value="draft" id="saveDraftBtn" class="btn">Save Draft</button>
							</div>
						</form>
					</div>
				</aside>
			</div>

			<!-- Bookings section (anchor) -->
			<div style="margin-top:18px" id="bookings">
				<div class="panel">
					<h3>Bookings</h3>
					<div class="tabs" style="margin-top:10px">
						<button class="active" data-tab="all">All</button>
						<button data-tab="pending">Pending</button>
						<button data-tab="approved">Approved</button>
						<button data-tab="rejected">Rejected</button>
					</div>
					<div class="tab-content" style="margin-top:8px">
						<table>
							<thead><tr><th>User</th><th>Center</th><th>Date</th><th>Time</th><th>Status</th><th>Actions</th></tr></thead>
							<tbody id="bookingTableBody">
								@forelse($bookings as $booking)
									<tr class="booking-row" data-status="{{ $booking->status }}">
										<td>{{ $booking->user->email }}</td>
										<td>{{ $booking->center->name }}</td>
										<td>{{ $booking->booking_date }}</td>
										<td>{{ $booking->start_time }} - {{ $booking->end_time }}</td>
										<td>
											<span class="status-badge" style="padding:3px 8px;border-radius:12px;font-size:12px;
												background-color:{{ $booking->status == 'pending' ? 'rgba(234,179,8,0.2)' : ($booking->status == 'approved' ? 'rgba(16,185,129,0.2)' : 'rgba(239,68,68,0.2)') }};
												color:{{ $booking->status == 'pending' ? '#eab308' : ($booking->status == 'approved' ? '#10b981' : '#ef4444') }}">
												{{ ucfirst($booking->status) }}
											</span>
										</td>
										<td>
											<a href="{{ route('admin.bookings.show', $booking->id) }}" class="btn">View</a>
											<form action="{{ route('admin.bookings.status', $booking->id) }}" method="POST" style="display:inline">
												@csrf
												@method('PATCH')
												@if($booking->status != 'approved')
													<button type="submit" name="status" value="approved" class="btn" style="color:#10b981">Approve</button>
												@endif
												@if($booking->status != 'rejected')
													<button type="submit" name="status" value="rejected" class="btn" style="color:#ef4444">Reject</button>
												@endif
											</form>
										</td>
									</tr>
								@empty
									<tr><td colspan="6" style="text-align:center;color:var(--muted)">No bookings found</td></tr>
								@endforelse
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<!-- Events management -->
			<div style="margin-top:18px" id="events">
				<div class="panel">
					<h3>Events</h3>
					<div class="tabs" style="margin-top:10px">
						<button class="active" data-tab="upcoming-tab">Upcoming</button>
						<button data-tab="past-tab">Past</button>
					</div>
					<div class="tab-content" style="margin-top:10px" id="upcoming-tab">
						<table>
							<thead><tr><th>Title</th><th>Date</th><th>Photo</th><th>Status</th><th>Actions</th></tr></thead>
							<tbody>
								@forelse($upcoming_events as $event)
									<tr>
										<td>{{ $event->title }}</td>
										<td>{{ $event->event_date }} {{ $event->event_time }}</td>
										<td>
											@if($event->image)
												<img src="{{ Storage::url($event->image) }}" style="width:80px;height:40px;object-fit:cover;border-radius:6px"/>
											@else
												<img src="{{ asset('images/bg1.jpg') }}" style="width:80px;height:40px;object-fit:cover;border-radius:6px"/>
											@endif
										</td>
										<td>
											<span style="padding:3px 8px;border-radius:12px;font-size:12px;
												background-color:{{ $event->status == 'draft' ? 'rgba(234,179,8,0.2)' : 'rgba(16,185,129,0.2)' }};
												color:{{ $event->status == 'draft' ? '#eab308' : '#10b981' }}">
												{{ ucfirst($event->status) }}
											</span>
										</td>
										<td>
											<a href="{{ route('events.edit', $event->id) }}" class="btn"><i class="fas fa-edit"></i></a>
											<form action="{{ route('events.destroy', $event->id) }}" method="POST" style="display:inline">
												@csrf
												@method('DELETE')
												<button type="submit" class="btn" onclick="return confirm('Are you sure you want to delete this event?')"><i class="fas fa-trash"></i></button>
											</form>
										</td>
									</tr>
								@empty
									<tr><td colspan="5" style="text-align:center;color:var(--muted)">No upcoming events found</td></tr>
								@endforelse
							</tbody>
						</table>
					</div>
					<div class="tab-content" style="margin-top:10px;display:none" id="past-tab">
						<table>
							<thead><tr><th>Title</th><th>Date</th><th>Photo</th><th>Status</th><th>Actions</th></tr></thead>
							<tbody>
								@forelse($past_events as $event)
									<tr>
										<td>{{ $event->title }}</td>
										<td>{{ $event->event_date }} {{ $event->event_time }}</td>
										<td>
											@if($event->image)
												<img src="{{ Storage::url($event->image) }}" style="width:80px;height:40px;object-fit:cover;border-radius:6px"/>
											@else
												<img src="{{ asset('images/bg1.jpg') }}" style="width:80px;height:40px;object-fit:cover;border-radius:6px"/>
											@endif
										</td>
										<td>
											<span style="padding:3px 8px;border-radius:12px;font-size:12px;
												background-color:{{ $event->status == 'draft' ? 'rgba(234,179,8,0.2)' : 'rgba(16,185,129,0.2)' }};
												color:{{ $event->status == 'draft' ? '#eab308' : '#10b981' }}">
												{{ ucfirst($event->status) }}
											</span>
										</td>
										<td>
											<a href="{{ route('events.edit', $event->id) }}" class="btn"><i class="fas fa-edit"></i></a>
											<form action="{{ route('events.destroy', $event->id) }}" method="POST" style="display:inline">
												@csrf
												@method('DELETE')
												<button type="submit" class="btn" onclick="return confirm('Are you sure you want to delete this event?')"><i class="fas fa-trash"></i></button>
											</form>
										</td>
									</tr>
								@empty
									<tr><td colspan="5" style="text-align:center;color:var(--muted)">No past events found</td></tr>
								@endforelse
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<!-- Users -->
			<div style="margin-top:18px" id="users">
				<div class="panel">
					<h3>Users</h3>
					<div style="margin-top:10px;overflow:auto">
						<table>
							<thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Actions</th></tr></thead>
							<tbody>
								@forelse($users as $user)
									<tr>
										<td>{{ $user->name }}</td>
										<td>{{ $user->email }}</td>
										<td>{{ ucfirst($user->role) }}</td>
										<td>Active</td>
										<td>
											<button class="btn"><i class="fas fa-edit"></i> Edit</button>
										</td>
									</tr>
								@empty
									<tr><td colspan="5" style="text-align:center;color:var(--muted)">No users found</td></tr>
								@endforelse
							</tbody>
						</table>
					</div>
				</div>
			</div>

		</main>
	</div>

	<script>
		// Sidebar submenu toggle
		document.querySelectorAll('.nav .section > a').forEach(a => {
			a.addEventListener('click', (e) => {
				const target = a.getAttribute('data-target');
				if (!target) return; // some links are simple anchors
				const parentSub = document.querySelector('.submenu[data-parent="'+target+'"]');
				if (parentSub) {
					parentSub.style.display = parentSub.style.display === 'flex' ? 'none' : 'flex';
				}
			});
		});

		// Tabs
		document.querySelectorAll('.tabs').forEach(tabGroup => {
			tabGroup.querySelectorAll('button').forEach(btn => btn.addEventListener('click', () => {
				btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
				btn.classList.add('active');
				
				// Handle event tabs
				if (btn.getAttribute('data-tab') === 'upcoming-tab') {
					document.getElementById('upcoming-tab').style.display = 'block';
					document.getElementById('past-tab').style.display = 'none';
				} else if (btn.getAttribute('data-tab') === 'past-tab') {
					document.getElementById('upcoming-tab').style.display = 'none';
					document.getElementById('past-tab').style.display = 'block';
				}
				
				// Handle booking tabs
				if (tabGroup.closest('#bookings')) {
					const status = btn.getAttribute('data-tab');
					const rows = document.querySelectorAll('.booking-row');
					
					rows.forEach(row => {
						if (status === 'all') {
							row.style.display = 'table-row';
						} else {
							row.style.display = row.getAttribute('data-status') === status ? 'table-row' : 'none';
						}
					});
				}
			}));
		});

		// Quick open
		function openSection(id){
			const el = document.getElementById(id);
			if (el){ el.scrollIntoView({behavior:'smooth', block:'start'}); el.style.transition='background 0.3s'; el.style.background='rgba(255,255,255,0.01)'; setTimeout(()=>el.style.background='transparent',700); }
		}

		// Image preview for Create Event form
		const imgInput = document.getElementById('imgInput');
		const imgPreview = document.getElementById('imgPreview');
		const fileLabelText = document.getElementById('fileLabelText');
		if (imgInput) {
			imgInput.addEventListener('change', (e) => {
				const file = e.target.files && e.target.files[0];
				if (!file) return;
				fileLabelText.innerText = file.name;
				const reader = new FileReader();
				reader.onload = () => imgPreview.src = reader.result;
				reader.readAsDataURL(file);
			});
			// clicking label opens file chooser
			document.querySelectorAll('.file-label').forEach(lbl => lbl.addEventListener('click', () => imgInput.click()));
		}

		// Auto-hide alerts after 5 seconds
		setTimeout(() => {
			const alerts = document.querySelectorAll('.alert');
			alerts.forEach(alert => {
				alert.style.transition = 'opacity 0.5s';
				alert.style.opacity = '0';
				setTimeout(() => alert.style.display = 'none', 500);
			});
		}, 5000);
	</script>
</body>
</html>
